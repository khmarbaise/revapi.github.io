
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-04-25
 Rendered using Msb3 Maven Skin 0.1.1 (http://tunguski.github.io/msb3-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Revapi Maven Plugin - Multi-file Configuration</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://bootswatch.com/cosmo/bootstrap.min.css" rel="stylesheet" />
		<link href="../css/bootswatch.css" rel="stylesheet" />
		<link href="../css/msb3-skin.css" rel="stylesheet" />

		<link href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/default.min.css" rel="stylesheet" />

		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>(adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3133590320590126",
          enable_page_level_ads: true
        });</script>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-57095904-1', 'auto');
        ga('send', 'pageview');</script>
<link rel="alternate" href="https://revapi.org/news.atom" type="application/rss+xml" title="Revapi News"/>
	</head>

	<body class="page-examples-multi-file-configuration project-revapi-maven-plugin" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<header class="navbar navbar-default navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<a class="navbar-toggle collapsed" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="navbar-brand" href="../../..">Revapi</a>
				</div>
					<div class="collapse navbar-collapse" id="top-nav-collapse">
						<ul class="nav navbar-nav navbar-right">
							<li ><a href="https://diff.revapi.org" title="Online Check" class="externalLink">Online Check</a></li>
							<li ><a href="../../../news.html" title="News">News</a></li>
							<li ><a href="../../../getting-started.html" title="Getting Started">Getting Started</a></li>
							<li ><a href="../../../downloads.html" title="Downloads">Downloads</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Basic Info <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../../architecture.html" title="Architecture">Architecture</a></li>
									<li ><a href="../../../building.html" title="Building">Building</a></li>
									<li ><a href="../../../extensions.html" title="Extensions">Extensions</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Sub Projects <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../revapi/index.html" title="Revapi API">Revapi API</a></li>
									<li ><a href="../../revapi-ant-task/index.html" title="Ant Task">Ant Task</a></li>
									<li ><a href="../../revapi-basic-features/index.html" title="Basic Features">Basic Features</a></li>
									<li ><a href="../../revapi-java/index.html" title="Java Extension">Java Extension</a></li>
									<li ><a href="../../revapi-java-spi/index.html" title="Java Extension SPI">Java Extension SPI</a></li>
									<li ><a href="../../revapi-reporter-text/index.html" title="Text Report Extension">Text Report Extension</a></li>
									<li ><a href="../index.html" title="Maven Plugin">Maven Plugin</a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Details <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../plugin-info.html" title="Goals">Goals</a></li>
									<li ><a href="specifying-versions.html" title="Specifying Versions To Check">Specifying Versions To Check</a></li>
									<li ><a href="configuration.html" title="Configuration">Configuration</a></li>
									<li ><a href="evolving-with-semver.html" title="Evolving With Semver Versioning Rules">Evolving With Semver Versioning Rules</a></li>
									<li class="active"><a href="" title="Multi-file Configuration">Multi-file Configuration</a></li>
									<li ><a href="report.html" title="Report">Report</a></li>
									<li ><a href="comparing-specific-artifacts.html" title="Comparing Specific Artifacts">Comparing Specific Artifacts</a></li>
									<li ><a href="updating-versions.html" title="Determining New Version String">Determining New Version String</a></li>
									<li ><a href="updating-release-properties.html" title="Setting Versions In release.properties">Setting Versions In release.properties</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
			</div>
		</header>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron">
		<div class="row">
			<div class="col-md-12">
				<div class="pull-left">
					<a href="https://revapi.org/modules/revapi-maven-plugin" id="bannerLeft"><h1>Revapi Maven Plugin</h1></a>
					<p class="lead">Maven integration for Revapi.</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="col-md-8">
			<div class="body-content">
<div class="sect1"> 
 <div class="page-header">
  <h2 id="a_multi_file_configuration">Multi-file Configuration</h2>
 </div> 
 <div class="sectionbody"> 
  <div class="paragraph"> 
   <p>Sometimes it can be handy to split the configuration of Revapi analysis in separate files - this can be done for various reasons - you might want to keep the config of different extensions separate or you want to compose the config from various contributing locations, etc.</p> 
  </div> 
  <div class="paragraph"> 
   <p>For Revapi, this can be achieved by using the <code>analysisConfigurationFiles</code> configuration element instead of (or in addition to) the <code>analysisConfiguration</code> element which provides the in-POM way of configuring Revapi.</p> 
  </div> 
  <div class="listingblock"> 
   <div class="content"> 
    <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.revapi&lt;/groupId&gt;
    &lt;artifactId&gt;revapi-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;...&lt;/version&gt;
    ...
    &lt;configuration&gt;
        &lt;analysisConfigurationFiles&gt;
            &lt;file&gt;${project.basedir}/config/filter.json&lt;/file&gt;
            &lt;file&gt;${project.basedir}/config/ignore.xml&lt;/file&gt;
        &lt;/analysisConfigurationFiles&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;&lt;goal&gt;check&lt;/goal&gt;&lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre> 
   </div> 
  </div> 
  <div class="paragraph"> 
   <p>Each of the configuration files (e.g. <code>filter.json</code> and <code>ignore.xml</code> in the above example) is a JSON or XML document with the configuration. The maven plugin then merges the files together (in an unspecified order) and uses the result as the final configuration for the analysis.</p> 
  </div> 
  <div class="sect2"> 
   <h3 id="a_using_configuration_defined_in_other_modules">Using Configuration Defined In Other Modules</h3> 
   <div class="paragraph"> 
    <p>It is possible to define a JAR artifact that contains "common" configuration of the Revapi analysis shared by many modules. To reference it, simply add the artifact as a dependency of the revapi maven plugin and reference the configuration file inside that artifact like:</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.revapi&lt;/groupId&gt;
    &lt;artifactId&gt;revapi-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;...&lt;/version&gt;
    &lt;dependencies&gt;
      ...
      &lt;dependency&gt;
        &lt;groupId&gt;my.group.id&lt;/groupId&gt;
        &lt;artifactId&gt;artifact-with-common-config&lt;/artifact&gt;
        &lt;version&gt;...&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;configuration&gt;
        &lt;analysisConfigurationFiles&gt;
          &lt;configurationFile&gt;
            &lt;resource&gt;path/to/the/config/file/in/the/shared/artifact&lt;/resource&gt;
          &lt;/configurationFile&gt;
          ...
        &lt;/analysisConfigurationFiles&gt;
        ...
    &lt;/configuration&gt;
    ...
&lt;/plugin&gt;</code></pre> 
    </div> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="a_merging_configuration_from_multiple_files">Merging Configuration From Multiple Files</h3> 
   <div class="paragraph"> 
    <p>When the analysis configuration is split amongst several files, it needs to be merged together before it is applied to the Revapi extensions. This process is slightly complex with the ability for a single extension to be configured multiple times but in the end is somewhat similar to the way Maven merges the executions of a plugin - as long as the executions are defined once in the effective POM, they don’t need to be assigned IDs. If there are multiple executions and you override them in child POMs, they need to have the IDs assigned so that it is clear what executions in child POM need to be merged with what executions in the parent POM.</p> 
   </div> 
   <div class="paragraph"> 
    <p>In Revapi, too, an extension configuration can optionally have an ID. In JSON this is expressed like this:</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="highlight"><code class="language-javascript" data-lang="javascript">...
    {
      "extension": "my.extension",
      "id": "id",
      "configuration": ...
    }
...</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>and in XML like so:</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="highlight"><code class="language-xml" data-lang="xml">...
    &lt;my.extension id="myid"&gt;
      ...
    &lt;/my.extension&gt;
...</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>When merging configurations without an explicit ID, everything works as long as there is at most a single configuration for each extension in each configuration file to be merged. As soon as there is more than one configuration for some extension in one of the configuration files, you need to assign IDs to the configurations of that extension so that it is clear what configs should be merged with what.</p> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="a_custom_root_element_of_configuration">Custom Root Element of Configuration</h3> 
   <div class="paragraph"> 
    <p>It might sometimes be useful to be able to only use a part of a JSON document as configuration for Revapi. This might be because the same file might be used for holding other data, too, or because the file(s) contain(s) multiple Revapi configurations. Note that the custom root is only applicable to configuration files, not the in-POM configuration.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The below example illustrates the usage of the custom configuration root.</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.revapi&lt;/groupId&gt;
    &lt;artifactId&gt;revapi-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;...&lt;/version&gt;
    ...
    &lt;configuration&gt;
        &lt;analysisConfigurationFiles&gt;
            &lt;file&gt;${project.basedir}/config/filter.json&lt;/file&gt;
            &lt;file&gt;${project.basedir}/config/ignore.json&lt;/file&gt;
            &lt;file&gt;
              &lt;path&gt;${project.basedir}/config/json-data-for-many-things.json&lt;/path&gt;
              &lt;roots&gt;
                &lt;root&gt;configuration/revapi&lt;/root&gt;
              &lt;/roots&gt;
            &lt;/file&gt;
            &lt;file&gt;
              &lt;path&gt;${project.basedir}/config/xml-data-for-many-things.xml&lt;/path&gt;
              &lt;roots&gt;
                &lt;root&gt;configuration/revapi&lt;/root&gt;
              &lt;/roots&gt;
            &lt;/file&gt;
        &lt;/analysisConfigurationFiles&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;&lt;goal&gt;check&lt;/goal&gt;&lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>The above would read the configuration from the <code>filter.json</code> and <code>ignore.json</code> files. In addition it would also read the configuration from the <code>json-data-for-many-things.json</code> and <code>xml-data-for-many-things.xml</code> files but would only consider the data from the "configuration/revapi" subpath in those file. E.g. if the files looked like:</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="highlight"><code class="language-javascript" data-lang="javascript">{
  "itest-setup": {...},
  "configuration": {
    "our-custom-tool": {
    },
    "revapi": {
      ... HERE WE ARE ...
    }
  }
}</code></pre> 
    </div> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;configuration&gt;
  &lt;ci&gt;...&lt;/ci&gt;
  &lt;revapi&gt;
     ... HERE WE ARE ...
  &lt;/revapi&gt;
&lt;/configuration&gt;</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>The Revapi configurations would only be read from the "…​ HERE WE ARE …​" part of the documents.</p> 
   </div> 
   <div class="paragraph"> 
    <p>Revapi itself uses this approach to track the changes made to its API across the versions using a single file. Each Revapi module can have a "api-changes.json" file in its base directory. The contents of this file follow this pattern:</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="highlight"><code class="language-javascript" data-lang="javascript">{
  "version1": {
    "revapi": {
      "ignore": [
        ...
      ]
    }
  },
  "version2": {
    "revapi": {
      "ignore": [
        ...
      ]
    }
  },
  ...
}</code></pre> 
    </div> 
   </div> 
   <div class="paragraph"> 
    <p>I.e. in that file, the root elements are the released versions of revapi and under them there are configurations for revapi for the particular version to pass the build. Usually, this is just a list of ignored API changes - i.e. the API changes made in that release that are to be purposefully ignored by the tool so that the build passes. To make this work, revapi build contains this profile:</p> 
   </div> 
   <div class="listingblock"> 
    <div class="content"> 
     <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;profile&gt;
    &lt;id&gt;api-check&lt;/id&gt;
    &lt;activation&gt;
        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
    &lt;/activation&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;parse-version&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;parse-version&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;phase&gt;validate&lt;/phase&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;

            &lt;plugin&gt;
                &lt;groupId&gt;org.revapi&lt;/groupId&gt;
                &lt;artifactId&gt;revapi-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${self-api-check.maven-version}&lt;/version&gt;
                &lt;dependencies&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.revapi&lt;/groupId&gt;
                        &lt;artifactId&gt;revapi-java&lt;/artifactId&gt;
                        &lt;version&gt;${self-api-check.java-extension-version}&lt;/version&gt;
                    &lt;/dependency&gt;
                &lt;/dependencies&gt;
                &lt;configuration&gt;
                    &lt;failOnMissingConfigurationFiles&gt;false&lt;/failOnMissingConfigurationFiles&gt;
                    &lt;analysisConfigurationFiles&gt;
                        &lt;configurationFile&gt;
                            &lt;path&gt;api-changes.json&lt;/path&gt;
                            &lt;roots&gt;
                                &lt;root&gt;${parsedVersion.majorVersion}.${parsedVersion.minorVersion}.${parsedVersion.incrementalVersion}&lt;/root&gt;
                            &lt;/roots&gt;
                        &lt;/configurationFile&gt;
                    &lt;/analysisConfigurationFiles&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;api-check&lt;/id&gt;
                        &lt;goals&gt;&lt;goal&gt;check&lt;/goal&gt;&lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/profile&gt;</code></pre> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
			</div>
		</div>
		<div class="col-md-4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#a_multi_file_configuration" title="Multi-file Configuration">Multi-file Configuration <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#a_using_configuration_defined_in_other_modules" title="Using Configuration Defined In Other Modules">Using Configuration Defined In Other Modules</a>
		<li><a href="#a_merging_configuration_from_multiple_files" title="Merging Configuration From Multiple Files">Merging Configuration From Multiple Files</a>
		<li><a href="#a_custom_root_element_of_configuration" title="Custom Root Element of Configuration">Custom Root Element of Configuration</a>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="col-md-3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Basic Info</li>
						<li >
							<a href="../../../architecture.html" title="Architecture">Architecture</a>
						</li>
						<li >
							<a href="../../../building.html" title="Building">Building</a>
						</li>
						<li >
							<a href="../../../extensions.html" title="Extensions">Extensions</a>
						</li>
						<li class="nav-header">Sub Projects</li>
						<li >
							<a href="../../revapi/index.html" title="Revapi API">Revapi API</a>
						</li>
						<li >
							<a href="../../revapi-ant-task/index.html" title="Ant Task">Ant Task</a>
						</li>
						<li >
							<a href="../../revapi-basic-features/index.html" title="Basic Features">Basic Features</a>
						</li>
						<li >
							<a href="../../revapi-java/index.html" title="Java Extension">Java Extension</a>
						</li>
						<li >
							<a href="../../revapi-java-spi/index.html" title="Java Extension SPI">Java Extension SPI</a>
						</li>
						<li >
							<a href="../../revapi-reporter-text/index.html" title="Text Report Extension">Text Report Extension</a>
						</li>
						<li >
							<a href="../index.html" title="Maven Plugin">Maven Plugin</a>
						</li>
					</ul>
				</div>
				<div class="col-md-3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Details</li>
						<li >
							<a href="../plugin-info.html" title="Goals">Goals</a>
						</li>
						<li >
							<a href="specifying-versions.html" title="Specifying Versions To Check">Specifying Versions To Check</a>
						</li>
						<li >
							<a href="configuration.html" title="Configuration">Configuration</a>
						</li>
						<li >
							<a href="evolving-with-semver.html" title="Evolving With Semver Versioning Rules">Evolving With Semver Versioning Rules</a>
						</li>
						<li class="active">
							<a href="#" title="Multi-file Configuration">Multi-file Configuration</a>
						</li>
						<li >
							<a href="report.html" title="Report">Report</a>
						</li>
						<li >
							<a href="comparing-specific-artifacts.html" title="Comparing Specific Artifacts">Comparing Specific Artifacts</a>
						</li>
						<li >
							<a href="updating-versions.html" title="Determining New Version String">Determining New Version String</a>
						</li>
						<li >
							<a href="updating-release-properties.html" title="Setting Versions In release.properties">Setting Versions In release.properties</a>
						</li>
					</ul>
				</div>
				<div class="col-md-3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven Documentation</li>
						<li >
							<a href="../project-info.html" title="Project Information">Project Information <i class="glyphicon glyphicon-chevron-right"></i></a>
						</li>
						<li >
							<a href="../project-reports.html" title="Project Reports">Project Reports <i class="glyphicon glyphicon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
				<div class="col-md-3 bottom-description">
					<blockquote>Revapi Maven Plugin</blockquote>
					<blockquote class="version-date"><span class="projectVersion">Version: 0.9.1</span><br/><span class="publishDate">Last Published: 2017-04-25</span></blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="col-md-12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017 <a href="http://lukas.krejci.pw">Lukas Krejci</a>. All Rights Reserved.</p>
				<p><a href="http://github.com/tunguski/msb3-maven-skin" title="Msb3 Maven skin">Msb3 Maven skin</a> by <a href="http://matsuo.pl" target="_blank" title="Marek Romanowski">Marek Romanowski</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/msb3-scroll.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>

	<script src="../js/msb3-skin.js"></script>

	</body>
</html>